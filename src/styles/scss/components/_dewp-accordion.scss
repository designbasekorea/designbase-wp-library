/**
 * DesignBase Frontend Kit - 아코디언 컴포넌트
 * 접을 수 있는 콘텐츠 섹션을 제공하는 컴포넌트 스타일을 정의
 */

@use "../basic/index" as *;
@use "sass:color";

.dewp-accordion {
    display: flex;
    flex-direction: column;
    gap: $spacing-1;
    border: 1px solid $border-02;
    border-radius: $radius-2;
    overflow: hidden;
    background: $bg-primary;

    // ============================================================================
    // 아코디언 아이템
    // ============================================================================

    .dewp-accordion-item {
        border-bottom: 1px solid $border-01;

        &:last-child {
            border-bottom: none;
        }

        &.active {
            .dewp-accordion-header {
                background: $bg-secondary;
                border-bottom-color: $border-02;

                .dewp-accordion-icon {
                    transform: rotate(180deg);
                }
            }

            .dewp-accordion-content {
                display: block;
            }
        }
    }

    // ============================================================================
    // 아코디언 헤더
    // ============================================================================

    .dewp-accordion-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: $spacing-4 $spacing-5;
        background: $bg-primary;
        border: none;
        cursor: pointer;
        transition: all $transition-base;
        user-select: none;
        font-family: inherit;
        font-size: $font-size-base;
        font-weight: $font-weight-semibold;
        color: $text-primary;
        text-align: left;
        width: 100%;
        min-height: 56px;

        &:hover {
            background: $bg-secondary;
            color: $text-primary;
        }

        &:focus {
            @include focus-ring($primary);
        }

        &:active {
            background: $bg-secondary;
        }

        // 헤더 내부 콘텐츠
        .dewp-accordion-title {
            flex: 1;
            margin-right: $spacing-4;
            line-height: 1.4;
        }

        .dewp-accordion-subtitle {
            font-size: $font-size-s;
            font-weight: $font-weight-normal;
            color: $text-secondary;
            margin-top: $spacing-1;
            display: block;
        }

        // 헤더 우측 요소들
        .dewp-accordion-meta {
            display: flex;
            align-items: center;
            gap: $spacing-3;
            margin-left: auto;
        }

        .dewp-accordion-badge {
            background: $border-02;
            color: $text-secondary;
            font-size: $font-size-xs;
            padding: $spacing-1 $spacing-2;
            border-radius: $radius-3;
            font-weight: $font-weight-medium;
        }

        .dewp-accordion-count {
            background: $bg-secondary;
            color: $text-secondary;
            font-size: $font-size-xs;
            padding: $spacing-1 $spacing-2;
            border-radius: $radius-1;
            font-weight: $font-weight-medium;
            min-width: 20px;
            text-align: center;
        }

        // 화살표 아이콘
        .dewp-accordion-icon {
            width: 20px;
            height: 20px;
            transition: transform $transition-base;
            color: $text-muted;
            flex-shrink: 0;

            svg {
                width: 100%;
                height: 100%;
                fill: currentColor;
            }
        }

        // 기본 화살표 (커스텀 아이콘이 없을 때 자동 표시)
        &:not(:has(.dewp-accordion-icon))::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: $spacing-3;
            background-repeat: no-repeat;
            background-position: center;
            background-size: 16px 16px;
            transition: transform $transition-base;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor'%3e%3cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z' clip-rule='evenodd'/%3e%3c/svg%3e");
        }

        // 커스텀 아이콘
        .dewp-accordion-custom-icon {
            width: 24px;
            height: 24px;
            margin-right: $spacing-3;
            flex-shrink: 0;

            svg {
                width: 100%;
                height: 100%;
                fill: currentColor;
            }
        }

        // 열린 상태에서 기본 화살표 회전
        &[aria-expanded="true"]:not(:has(.dewp-accordion-icon))::after {
            transform: rotate(180deg);
        }
    }

    // ============================================================================
    // 아코디언 콘텐츠
    // ============================================================================

    .dewp-accordion-content {
        display: none;
        padding: 0;
        background: $bg-primary;
        color: $text-primary;
        line-height: 1.6;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

        .dewp-accordion-content-inner {
            padding: $spacing-5;
        }

        // 콘텐츠 내부 요소들
        p {
            margin: 0 0 $spacing-4 0;
            color: $text-secondary;

            &:last-child {
                margin-bottom: 0;
            }
        }

        ul,
        ol {
            margin: 0 0 $spacing-4 0;
            padding-left: $spacing-5;
            color: $text-secondary;

            li {
                margin-bottom: $spacing-2;

                &:last-child {
                    margin-bottom: 0;
                }
            }
        }

        // 콘텐츠 내부 테이블
        .dewp-table {
            margin: $spacing-4 0;
        }

        // 콘텐츠 내부 폼
        .dewp-form-group {
            margin-bottom: $spacing-4;
        }

        // 콘텐츠 내부 버튼
        .dewp-btn {
            margin-right: $spacing-2;
            margin-bottom: $spacing-2;

            &:last-child {
                margin-right: 0;
            }
        }
    }

    // ============================================================================
    // 아코디언 크기
    // ============================================================================

    &-sm {
        .dewp-accordion-header {
            padding: $spacing-3 $spacing-4;
            min-height: 48px;
            font-size: $font-size-s;

            .dewp-accordion-icon {
                width: 16px;
                height: 16px;
            }

            .dewp-accordion-custom-icon {
                width: 20px;
                height: 20px;
                margin-right: $spacing-2;
            }
        }

        .dewp-accordion-content {

            .dewp-accordion-content-inner {
                padding: 16px;
            }
        }
    }

    &-lg {
        .dewp-accordion-header {
            padding: 20px 24px;
            min-height: 64px;
            font-size: 18px;

            .dewp-accordion-icon {
                width: 24px;
                height: 24px;
            }

            .dewp-accordion-custom-icon {
                width: 28px;
                height: 28px;
                margin-right: 16px;
            }
        }

        .dewp-accordion-content {

            .dewp-accordion-content-inner {
                padding: $spacing-6;
                font-size: $font-size-base;
            }
        }
    }

    // ============================================================================
    // 아코디언 변형
    // ============================================================================

    &-bordered {
        border: 1px solid #d1d5db;
        border-radius: 8px;

        .dewp-accordion-item {
            border-bottom: 1px solid #e5e7eb;

            &:last-child {
                border-bottom: none;
            }
        }
    }

    &-separated {
        gap: 8px;
        border: none;
        background: transparent;

        .dewp-accordion-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;

            &:last-child {
                border-bottom: 1px solid #e5e7eb;
            }
        }
    }

    &-minimal {
        border: none;
        background: transparent;
        gap: 0;

        .dewp-accordion-item {
            border: none;
            background: transparent;

            .dewp-accordion-header {
                background: transparent;
                padding: 12px 0;
                border-bottom: 1px solid #f3f4f6;

                &:hover {
                    background: transparent;
                    color: #3b82f6;
                }
            }

            .dewp-accordion-content {
                padding: 0 0 16px 0;
            }

            &.active .dewp-accordion-header {
                background: transparent;
                color: #3b82f6;
                border-bottom-color: #3b82f6;
            }
        }
    }

    // ============================================================================
    // 아코디언 테마
    // ============================================================================

    &-primary {
        .dewp-accordion-header {
            &.active {
                background: #eff6ff;
                color: #1e40af;
                border-bottom-color: #3b82f6;

                .dewp-accordion-icon {
                    color: #3b82f6;
                }
            }

            &:hover {
                background: #f0f9ff;
            }
        }
    }

    &-success {
        .dewp-accordion-header {
            &.active {
                background: #f0fdf4;
                color: #166534;
                border-bottom-color: #22c55e;

                .dewp-accordion-icon {
                    color: #22c55e;
                }
            }

            &:hover {
                background: #f0fdf4;
            }
        }
    }

    &-warning {
        .dewp-accordion-header {
            &.active {
                background: #fffbeb;
                color: #92400e;
                border-bottom-color: #f59e0b;

                .dewp-accordion-icon {
                    color: #f59e0b;
                }
            }

            &:hover {
                background: #fffbeb;
            }
        }
    }

    &-danger {
        .dewp-accordion-header {
            &.active {
                background: #fef2f2;
                color: #991b1b;
                border-bottom-color: #ef4444;

                .dewp-accordion-icon {
                    color: #ef4444;
                }
            }

            &:hover {
                background: #fef2f2;
            }
        }
    }

    // ============================================================================
    // 아코디언 상태
    // ============================================================================

    &-disabled {
        opacity: 0.6;
        pointer-events: none;

        .dewp-accordion-header {
            cursor: not-allowed;
            color: #9ca3af;
        }
    }

    &-loading {
        .dewp-accordion-header {
            cursor: wait;

            .dewp-accordion-icon {
                animation: spin 1s linear infinite;
            }
        }
    }

    // ============================================================================
    // 아코디언 애니메이션
    // ============================================================================

    &-animated {
        .dewp-accordion-content {
            transition: all 0.3s ease;
        }

        .dewp-accordion-header {
            .dewp-accordion-icon {
                transition: transform 0.3s ease;
            }
        }
    }

    // ============================================================================
    // 반응형 디자인
    // ============================================================================

    @media (max-width: 768px) {
        .dewp-accordion-header {
            padding: 14px 16px;
            min-height: 52px;
            font-size: 15px;

            .dewp-accordion-meta {
                gap: 8px;
            }

            .dewp-accordion-subtitle {
                font-size: 13px;
            }
        }

        .dewp-accordion-content {
            padding: 0 16px 18px;
        }

        &-lg .dewp-accordion-header {
            padding: 18px 20px;
            min-height: 60px;
            font-size: 17px;
        }
    }

    @media (max-width: 480px) {
        .dewp-accordion-header {
            padding: 12px 14px;
            min-height: 48px;
            font-size: 14px;

            .dewp-accordion-meta {
                flex-direction: column;
                align-items: flex-end;
                gap: 4px;
            }

            .dewp-accordion-subtitle {
                font-size: 12px;
            }
        }

        .dewp-accordion-content {
            padding: 0 14px 16px;
            font-size: 14px;
        }
    }
}

// ============================================================================
// 유틸리티 클래스
// ============================================================================

.dewp-accordion-group {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.dewp-accordion-inline {
    display: inline-block;
    min-width: 300px;
}

// ============================================================================
// 애니메이션 키프레임
// ============================================================================

@keyframes spin {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

// ============================================================================
// 접근성 개선
// ============================================================================

.dewp-accordion {
    [role="button"] {
        cursor: pointer;
    }

    [role="region"] {
        overflow: hidden;
    }

    [aria-expanded="true"] {
        .dewp-accordion-icon {
            transform: rotate(180deg);
        }
    }

    [aria-expanded="false"] {
        .dewp-accordion-icon {
            transform: rotate(0deg);
        }
    }
}